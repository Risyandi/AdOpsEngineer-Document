<html>

<head>

    <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
        crossorigin="anonymous"></script>

    <script type="text/javascript">
        // source external library googletag
        (function () {
            var useSSL = 'https:' == document.location.protocol;
            var src = (useSSL ? 'https:' : 'http:') +
                '//www.googletagservices.com/tag/js/gpt.js';
            document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
        })();
    </script>

    <script type="text/javascript">

        // define command googletag
        window.googletag = window.googletag || {};
        googletag.cmd = googletag.cmd || [];
        console.log(window.googletag, ": debug window googletag", googletag.cmd, ": debug command googletag");

        // adds elements
        googletag.cmd.push(function () {

            // googletag service
            googletag.pubads().enableSingleRequest();
            googletag.pubads().collapseEmptyDivs(true);

            // disable initial load, we will use refresh() to fetch ads.
            // calling this function means that display() calls just
            // register the slot as ready, but do not fetch ads for it.
            googletag.pubads().disableInitialLoad();
            googletag.enableServices();
        });

        // function to generate num id unique
        var numSlotId = 1;
        function generateIdSlotName() {
            var numId = numSlotId++;
            return 'WT_Homepage_Leaderboard_' + numId;
        }

        // function to load all elements ads
        function loadAllElementsAds() {
            // init of id name

            // create element foreach meet class leaderboard using jquery
            $('.dfp_leaderboard').each(function (indexAds) {
                //indexAds = indexAds + 1;
                if ($(this).html() <= 1) {
                    var slotIdName = generateIdSlotName();
                    console.log(slotIdName, "element leaderboard");
                    var appendTextLeaderboards =
                        "<div id='" + slotIdName + "'>" +
                        "<\/div>";
                    // append
                    $(this).append(appendTextLeaderboards);
                    var leaderboardSlot = googletag.defineSlot('/xxx/xxx/xxxx', [728, 90], slotIdName).addService(googletag.pubads());
                    console.log(leaderboardSlot, "define leaderboard");

                    googletag.display(slotIdName);
                    googletag.pubads().refresh([leaderboardSlot]);
                }
            });

        }

    </script>

</head>

<body>

    <h1>asdasdasdsdas</h1>
    <div class="dfp_leaderboard"></div>
    <p>asdsdas</p>
    <div class="dfp_leaderboard"></div>
    <p>asdsds</p>
    <div class="dfp_leaderboard"></div>

    <script>
        googletag.cmd.push(function () {
            loadAllElementsAds();
        });
    </script>

</body>

</html>