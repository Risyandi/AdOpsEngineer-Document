<!DOCTYPE html>
<html>
<head>
	<title> Test Page | Header Bidding</title>
	<script src="./prebidv2.js" async></script>
	<script type="text/javascript">
		var PREBID_TIMEOUT = 7000;

		var adUnits = [{
			code: 'div-gpt-ad-1519715790572-0', 
			mediaTypes: { 
				banner: { 
					sizes: [[320, 50], [468, 60], [728, 90]]
				}
			},
			bids: [{
				bidder: 'audienceNetwork', 
				params: {
					placementId: '207995792968314'
				}
			}]
		}];

		(function () {
			var gads = document.createElement('script');
			gads.async = true;
			gads.type = 'text/javascript';
			var useSSL = 'https:' == document.location.protocol;
			gads.src = (useSSL ? 'https:' : 'http:') + '//www.googletagservices.com/tag/js/gpt.js';
			var node = document.getElementsByTagName('script')[0];
			node.parentNode.insertBefore(gads, node);
			console.log(node);
		})();

		var googletag = googletag || {};
			googletag.cmd = googletag.cmd || [];
			googletag.cmd.push(function() { 
			googletag.pubads().disableInitialLoad();
		});

		googletag.cmd.push(function() {
			googletag.defineSlot('/118200697/Bolalob/bolalob_dev_lb', [[320, 50], [468, 60], [728, 90]], 'div-gpt-ad-1519715790572-0').addService(googletag.pubads());
			googletag.pubads().enableSingleRequest();
			googletag.pubads().collapseEmptyDivs();
			googletag.enableServices();
		});

		var sendAdserverRequest = function () {
			if (pbjs.adserverRequestSent) return;
			pbjs.adserverRequestSent = true;
			googletag.cmd.push(function() {
				pbjs.que.push(function() {
					pbjs.setTargetingForGPTAsync();
					googletag.pubads().refresh();
				});
			});
		};

		setTimeout(function() {
			sendAdserverRequest();
		}, PREBID_TIMEOUT);

		var pbjs = pbjs || {};
	    pbjs.que = pbjs.que || [];

	    pbjs.bidderSettings = {
	          audienceNetwork: {
	            adserverTargeting: [
	                  {
	                      key: "fb_bidid",
	                      val: function (bidResponse) {
	                          // make the bidId available for targeting if required
	                          return bidResponse.fbBidId;
	                      } 
	                  },
	                  {   
	                      key: "hb_bidder",
	                      val: function (bidResponse) {
	                          return bidResponse.bidderCode;
	                      }
	                  },
	                  {
	                    key: "hb_pb",  
	                    val: function(bidResponse) {
	                      return bidResponse.pbMg;
	                    }
	                  },
	              ],
	          },
	      };

	    pbjs.que.push(function() {
        pbjs.addAdUnits(adUnits);
        pbjs.requestBids({
            bidsBackHandler: sendAdserverRequest
        });
      });

	</script>
</head>
<body>
	<style type="text/css">
		.adv-test{
			display: block;
			text-align: center;
			margin: auto;
			padding: 10px;
		}	
	</style>
	<div class="adv-test">
		<h2>Test Prebid | Audience Networks</h2>
		<div id="div-gpt-ad-1519715790572-0">
			<script>
		        googletag.cmd.push(function() {
		          googletag.display('div-gpt-ad-1519715790572-0');
		        });
			</script>
		</div>
	</div>
</body>
</html>


<!-- 
   * Original tags from DFP for testing, Prebid JS
   * Header bidding
	<script async='async' src='https://www.googletagservices.com/tag/js/gpt.js'></script>
	<script>

	  var googletag = googletag || {};
	  googletag.cmd = googletag.cmd || [];
	</script>

	<script>
	  googletag.cmd.push(function() {
	    googletag.defineSlot('/118200697/Bolalob/bolalob_dev_lb', [[320, 50], [468, 60], [728, 90]], 'div-gpt-ad-1519715790572-0').addService(googletag.pubads());
	    googletag.pubads().enableSingleRequest();
	    googletag.pubads().collapseEmptyDivs();
	    googletag.enableServices();
	  });
	</script>
-->
<!-- /118200697/Bolalob/bolalob_dev_lb -->
<!--
	<div id='div-gpt-ad-1519715790572-0'>
	<script>
		googletag.cmd.push(function() {
		 googletag.display('div-gpt-ad-1519715790572-0'); 
		 });
	</script>
	</div>
-->
